AWSTemplateFormatVersion: '2010-09-09'
Description: Elastic Beanstalk app with environment

Resources:
  EBApplication:
    Type: AWS::ElasticBeanstalk::Application
    Properties:
      ApplicationName: MyApp
      Description: My Canary Deploy App

  EBApplicationVersion:
    Type: AWS::ElasticBeanstalk::ApplicationVersion
    Properties:
      ApplicationName: !Ref EBApplication
      Description: Initial version
      SourceBundle:
        S3Bucket: my-artifacts-azamcloud
        S3Key: app.zip

  EBEnvironment:
    Type: AWS::ElasticBeanstalk::Environment
    Properties:
      EnvironmentName: MyApp-env
      ApplicationName: !Ref EBApplication
      SolutionStackName: "64bit Amazon Linux 2023 v6.6.1 running Node.js 20"
      OptionSettings:
        - Namespace: aws:elasticbeanstalk:command
          OptionName: DeploymentPolicy
          Value: RollingWithAdditionalBatch
        - Namespace: aws:elasticbeanstalk:command
          OptionName: BatchSizeType
          Value: Percentage
        - Namespace: aws:elasticbeanstalk:command
          OptionName: BatchSize
          Value: 10
        - Namespace: aws:elasticbeanstalk:command
          OptionName: PauseTime
          Value: PT5M
      VersionLabel: !Ref EBApplicationVersion
      Tier:
        Name: WebServer
        Type: Standard
