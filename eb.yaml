AWSTemplateFormatVersion: '2010-09-09'
Description: Elastic Beanstalk app with environment

Resources:
  EBApplication:
    Type: AWS::ElasticBeanstalk::Application
    Properties:
      ApplicationName: MyApp
      Description: My Canary Deploy App

  EBApplicationVersion:
    Type: AWS::ElasticBeanstalk::ApplicationVersion
    Properties:
      ApplicationName: !Ref EBApplication
      Description: Initial version
      SourceBundle:
        S3Bucket: my-artifacts-azamcloud
        S3Key: app.zip

  EBEnvironment:
    Type: AWS::ElasticBeanstalk::Environment
    Properties:
      EnvironmentName: MyApp-env
      ApplicationName: !Ref EBApplication
      SolutionStackName: "64bit Amazon Linux 2023 v6.6.1 running Node.js 20"
      OptionSettings:
        - Namespace: aws:elasticbeanstalk:command
          OptionName: DeploymentPolicy
          Value: RollingWithAdditionalBatch
        - Namespace: aws:elasticbeanstalk:command
          OptionName: BatchSizeType
          Value: Percentage
        - Namespace: aws:elasticbeanstalk:command
          OptionName: BatchSize
          Value: 10
        - Namespace: aws:elasticbeanstalk:command
          OptionName: PauseTime
          Value: PT5M
        - Namespace: aws:autoscaling:launchconfiguration
          OptionName: IamInstanceProfile
          Value: aws-elasticbeanstalk-ec2-role
        - Namespace: aws:ec2:vpc
          OptionName: VPCId
          Value: vpc-0f4a5bd5b039ab9c5
        - Namespace: aws:ec2:vpc
          OptionName: Subnets
          Value: subnet-07ecaf649eb4dcc3c,subnet-0778d8f3d56702af8

      VersionLabel: !Ref EBApplicationVersion
      Tier:
        Name: WebServer
        Type: Standard
